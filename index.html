<html><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Système de Gestion de Stock</title>
    <style>
        @font-face {
            font-family: 'Arial';
            src: url('fonts/arial.woff2') format('woff2');
        }
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            background-color: #4a90e2;
            color: white;
            text-align: center;
            padding: 20px 0;
        }
        .nav {
            background-color: #333;
            padding: 10px 0;
        }
        .nav ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
            display: flex;
            justify-content: center;
        }
        .nav ul li {
            margin: 0 10px;
        }
        .nav ul li a {
            color: white;
            text-decoration: none;
        }
        .nav ul li a.active {
            background-color: #4a90e2;
            padding: 5px 10px;
            border-radius: 5px;
        }
        .content {
            background-color: white;
            padding: 20px;
            margin-top: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #4a90e2;
            color: white;
        }
        form {
            display: flex;
            flex-direction: column;
        }
        input, select {
            margin: 10px 0;
            padding: 5px;
        }
        button {
            background-color: #4a90e2;
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
            margin-top: 10px;
        }
        button:hover {
            background-color: #3a7bc8;
        }
        #loginForm {
            max-width: 300px;
            margin: 0 auto;
        }
        .product-image {
            width: 100px;
            height: 100px;
            object-fit: cover;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.6.2/sql-wasm.js"></script>
    </head>
    <body>
        <div class="header">
            <h1>Système de Gestion de Stock</h1>
        </div>
        <nav class="nav" id="mainNav" style="display: none;">
            <ul>
                <li><a href="#" onclick="showHomePage()">Accueil</a></li>
                <li><a href="#" onclick="showStockPage()">Gestion du Stock</a></li>
                <li><a href="#" onclick="showUserPage()">Gestion des Utilisateurs</a></li>
                <li><a href="#" onclick="logout()">Se déconnecter</a></li>
            </ul>
        </nav>
        <div class="container">
            <div class="content" id="mainContent">
                <!-- Le contenu dynamique sera inséré ici -->
            </div>
        </div>
    
        <script>
        let currentUser = null;
        let db;
    
        initSqlJs({ locateFile: file => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.6.2/${file}` })
          .then(SQL => {
            db = new SQL.Database();
            initializeDatabase();
          });
    
        function createTables() {
          db.run(`
            CREATE TABLE IF NOT EXISTS users (
              id INTEGER PRIMARY KEY AUTOINCREMENT,
              username TEXT UNIQUE,
              password TEXT,
              role TEXT
            );
    
            CREATE TABLE IF NOT EXISTS products (
              id INTEGER PRIMARY KEY AUTOINCREMENT,
              name TEXT,
              quantity INTEGER,
              price REAL,
              image TEXT
            );
    
            CREATE TABLE IF NOT EXISTS stock_movements (
              id INTEGER PRIMARY KEY AUTOINCREMENT,
              date TEXT,
              type TEXT,
              product_id INTEGER,
              quantity INTEGER,
              source TEXT,
              reference TEXT,
              price REAL,
              FOREIGN KEY (product_id) REFERENCES products(id)
            );
          `);
        }
    
        function initializeAdminUser() {
          db.run('INSERT OR IGNORE INTO users (username, password, role) VALUES (?, ?, ?)', 
            ['admin', 'admin', 'administrateur']);
        }
    
        function initializeDatabase() {
          createTables();
          initializeAdminUser();
        }
    
        function getUsers() {
          const stmt = db.prepare('SELECT * FROM users');
          const users = [];
          while (stmt.step()) {
            const row = stmt.getAsObject();
            users.push(row);
          }
          return users;
        }
    
        function addUser(user) {
          db.run('INSERT INTO users (username, password, role) VALUES (?, ?, ?)', 
            [user.username, user.password, user.role]);
        }
    
        function updateUser(user) {
          db.run('UPDATE users SET password = ?, role = ? WHERE username = ?', 
            [user.password, user.role, user.username]);
        }
    
        function deleteUser(username) {
          db.run('DELETE FROM users WHERE username = ?', [username]);
        }
    
        function getProducts() {
          const stmt = db.prepare('SELECT * FROM products');
          const products = [];
          while (stmt.step()) {
            const row = stmt.getAsObject();
            products.push(row);
          }
          return products;
        }
    
        function addProduct(product) {
          db.run('INSERT INTO products (name, quantity, price, image) VALUES (?, ?, ?, ?)', 
            [product.name, product.quantity, product.price, product.image]);
        }
    
        function addStockMovement(movement) {
          db.run('INSERT INTO stock_movements (date, type, product_id, quantity, source, reference, price) VALUES (?, ?, ?, ?, ?, ?, ?)', 
            [movement.date, movement.type, movement.productId, movement.quantity, movement.source, movement.reference, movement.price]);
        }
    
        function getStockMovements(startDate, endDate) {
          const stmt = db.prepare(`
            SELECT * FROM stock_movements 
            WHERE date >= ? AND date <= ?
            ORDER BY date ASC
          `);
          stmt.bind([startDate, endDate]);
          const movements = [];
          while (stmt.step()) {
            const row = stmt.getAsObject();
            movements.push(row);
          }
          return movements;
        }
    
        function updateProductQuantity(productId, quantity, type) {
          const product = getProducts().find(p => p.id === productId);
          if (product) {
            const newQuantity = type === 'entry' ? product.quantity + quantity : product.quantity - quantity;
            db.run('UPDATE products SET quantity = ? WHERE id = ?', [newQuantity, productId]);
          }
        }
    
        document.addEventListener('DOMContentLoaded', function() {
            mainContent = document.getElementById('mainContent');
    
            function showLoginForm() {
                mainContent.innerHTML = `
                    <h2>Connexion</h2>
                    <form id="loginForm">
                        <input type="text" id="username" placeholder="Nom d'utilisateur" required>
                        <input type="password" id="password" placeholder="Mot de passe" required>
                        <button type="submit">Se connecter</button>
                    </form>
                `;
                document.getElementById('loginForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    const username = document.getElementById('username').value;
                    const password = document.getElementById('password').value;
                    const user = getUsers().find(u => u.username === username && u.password === password);
                    if (user) {
                        currentUser = user;
                        mainNav.style.display = 'block';
                        showHomePage();
                    } else {
                        alert('Identifiants incorrects');
                    }
                });
            }
    
            window.showHomePage = function() {
                const navItems = {
                    'administrateur': ['Accueil', 'Gestion du Stock', 'Gestion des Utilisateurs'],
                    'magasinier': ['Accueil', 'Gestion du Stock'],
                    'service_vente': ['Accueil', 'Consulter les produits en stock'],
                    'service_production': ['Accueil', 'Consulter les produits en stock']
                };
    
                const userNavItems = navItems[currentUser.role];
    
                const navHTML = userNavItems.map(item => {
                    let functionName;
                    switch(item) {
                        case 'Accueil':
                            functionName = 'showHomePage';
                            break;
                        case 'Gestion du Stock':
                            functionName = 'showStockPage';
                            break;
                        case 'Gestion des Utilisateurs':
                            functionName = 'showUserPage';
                            break;
                        case 'Consulter les produits en stock':
                            functionName = 'viewStock';
                            break;
                        default:
                            functionName = 'showHomePage';
                    }
                    return `<li><a href="#" onclick="${functionName}()">${item}</a></li>`;
                }).join('');
    
                document.getElementById('mainNav').innerHTML = `
                    <ul>
                        ${navHTML}
                        <li><a href="#" onclick="logout()">Se déconnecter</a></li>
                    </ul>
                `;
    
                let welcomeMessage = '';
                switch(currentUser.role) {
                    case 'administrateur':
                        welcomeMessage = `Bienvenue, ${currentUser.username} (Administrateur)`;
                        break;
                    case 'magasinier':
                        welcomeMessage = `Bienvenue, ${currentUser.username} (Magasinier)`;
                        break;
                    case 'service_vente':
                        welcomeMessage = `Bienvenue, ${currentUser.username} (Service de vente)`;
                        break;
                    case 'service_production':
                        welcomeMessage = `Bienvenue, ${currentUser.username} (Service de production)`;
                        break;
                    default:
                        welcomeMessage = `Bienvenue, ${currentUser.username}`;
                }
    
                mainContent.innerHTML = `
                    <h2>${welcomeMessage}</h2>
                    <p>Veuillez sélectionner une option dans le menu ci-dessus pour accéder aux différentes fonctionnalités.</p>
                `;
                updateActiveMenuLink('Accueil');
            }
    
            window.showStockPage = function() {
                let stockOptions = `
                    <button onclick="viewStock()">Consulter les produits en stock</button>
                    <button onclick="showEntryForm()">Entrées en stock</button>
                    <button onclick="showExitForm()">Sorties en stock</button>
                    ${currentUser.role === 'administrateur' ? '<button onclick="showAddForm()">Enregistrer nouveau produit</button>' : ''}
                    <button onclick="showReports()">Rapports</button>
                `;
    
                mainContent.innerHTML = `
                    <h2>Gestion du Stock</h2>
                    ${stockOptions}
                    <div id="stockMovementFormContainer"></div>
                `;
                updateActiveMenuLink('Gestion du Stock');
            }
    
            window.viewStock = function() {
                const products = getProducts();
                mainContent.innerHTML = `
                    <h2>Produits en stock</h2>
                    <table>
                        <tr>
                            <th>Image</th>
                            <th>Nom</th>
                            <th>Quantité</th>
                            <th>Prix</th>
                        </tr>
                        ${products.map(p => `
                            <tr>
                                <td><img src="${p.image}" alt="${p.name}" class="product-image"></td>
                                <td>${p.name}</td>
                                <td>${p.quantity}</td>
                                <td>${p.price.toFixed(2)} €</td>
                            </tr>
                        `).join('')}
                    </table>
                `;
                updateActiveMenuLink('Consulter les produits en stock');
            }
    
            window.showEntryForm = function() {
                const currentDate = new Date().toISOString().split('T')[0];
                document.getElementById('stockMovementFormContainer').innerHTML = `
                    <h3>Entrée de stock</h3>
                    <form id="stockMovementForm">
                        <input type="date" id="movementDate" value="${currentDate}" required>
                        <select id="productId" required>
                            ${getProducts().map(p => `<option value="${p.id}">${p.name}</option>`).join('')}
                        </select>
                        <input type="number" id="quantity" placeholder="Quantité" required>
                        <input type="number" id="unitPrice" placeholder="Prix unitaire" step="0.01" required>
                        <input type="text" id="source" placeholder="Fournisseur" required>
                        <input type="text" id="reference" placeholder="Référence" readonly>
                        <button type="submit">Enregistrer l'entrée</button>
                    </form>
                `;
                document.getElementById('stockMovementForm').addEventListener('submit', handleStockMovementSubmit);
            }
    
            window.showExitForm = function() {
                const currentDate = new Date().toISOString().split('T')[0];
                document.getElementById('stockMovementFormContainer').innerHTML = `
                    <h3>Sortie de stock</h3>
                    <form id="stockMovementForm">
                        <input type="date" id="movementDate" value="${currentDate}" required>
                        <select id="productId" required>
                            ${getProducts().map(p => `<option value="${p.id}">${p.name}</option>`).join('')}
                        </select>
                        <input type="number" id="quantity" placeholder="Quantité" required>
                        <input type="number" id="unitPrice" placeholder="Prix unitaire" step="0.01" required>
                        <input type="text" id="source" placeholder="Client" required>
                        <input type="text" id="reference" placeholder="Référence" readonly>
                        <button type="submit">Enregistrer la sortie</button>
                    </form>
                `;
                document.getElementById('stockMovementForm').addEventListener('submit', handleStockMovementSubmit);
            }
    
            window.showAddForm = function() {
                const currentDate = new Date().toISOString().split('T')[0];
                document.getElementById('stockMovementFormContainer').innerHTML = `
                    <h3>Enregistrer nouveau produit</h3>
                    <form id="stockMovementForm">
                        <input type="date" id="movementDate" value="${currentDate}" required>
                        <input type="text" id="newProductName" placeholder="Nom du nouveau produit" required>
                        <input type="number" id="quantity" placeholder="Quantité" required>
                        <input type="number" id="price" placeholder="Prix" step="0.01" required>
                        <input type="file" id="productImage" accept="image/*">
                        <button type="submit">Ajouter le nouveau produit</button>
                    </form>
                `;
                document.getElementById('stockMovementForm').addEventListener('submit', handleNewProductSubmit);
            }
    
            window.showReports = function() {
                const currentDate = new Date().toISOString().split('T')[0];
                mainContent.innerHTML = `
                    <h2>Rapports</h2>
                    <div>
                        <h3>Rapport de stock</h3>
                        <button onclick="generateStockReport()">Générer rapport</button>
                    </div>
                    <div style="margin-top: 20px;">
                        <h3>Rapport des mouvements</h3>
                        <form id="movementReportForm">
                            <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 10px;">
                                <label for="movementReportStartDate">Du:</label>
                                <input type="date" id="movementReportStartDate" value="${currentDate}">
                                <label for="movementReportEndDate">Au:</label>
                                <input type="date" id="movementReportEndDate" value="${currentDate}">
                                <button type="submit">Générer rapport</button>
                            </div>
                        </form>
                    </div>
                    <div id="reportContainer" style="margin-top: 20px;"></div>
                `;
    
                document.getElementById('movementReportForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    generateMovementReport();
                });
            }
    
            window.generateMovementReport = function() {
                const startDate = document.getElementById('movementReportStartDate').value;
                const endDate = document.getElementById('movementReportEndDate').value;
    
                let movements = getStockMovements(startDate, endDate);
                let products = getProducts();
    
                let reportHTML = `
                    <h3>Rapport des mouvements du ${startDate} au ${endDate}</h3>
                    <table style="width: 100%; border-collapse: collapse; border: 2px solid black;">
                        <tr>
                            <th style="border: 1px solid black; padding: 5px;">Date / Heure</th>
                            <th style="border: 1px solid black; padding: 5px;">Numéros de bons/nom d'article</th>
                            <th colspan="3" style="border: 1px solid black; padding: 5px;">Sorties</th>
                            <th colspan="3" style="border: 1px solid black; padding: 5px;">Entrées</th>
                            <th colspan="3" style="border: 1px solid black; padding: 5px;">Stock</th>
                        </tr>
                        <tr>
                            <th style="border: 1px solid black; padding: 5px;"></th>
                            <th style="border: 1px solid black; padding: 5px;"></th>
                            <th style="border: 1px solid black; padding: 5px;">Quantité</th>
                            <th style="border: 1px solid black; padding: 5px;">Prix unitaire (FC)</th>
                            <th style="border: 1px solid black; padding: 5px;">Montant</th>
                            <th style="border: 1px solid black; padding: 5px;">Quantité</th>
                            <th style="border: 1px solid black; padding: 5px;">Prix unitaire (FC)</th>
                            <th style="border: 1px solid black; padding: 5px;">Montant</th>
                            <th style="border: 1px solid black; padding: 5px;">Quantité</th>
                            <th style="border: 1px solid black; padding: 5px;">Prix unitaire (FC)</th>
                            <th style="border: 1px solid black; padding: 5px;">Montant</th>
                        </tr>
                `;
    
                let totalExit = 0;
                let totalEntry = 0;
                let totalStock = 0;
    
                movements.forEach(movement => {
                    const product = products.find(p => p.id === movement.product_id);
                    const productName = product ? product.name : 'Unknown Product';
    
                    if (movement.type === 'new') {
                        return; // Skip new product movements
                    }
                    
                    reportHTML += `
                        <tr>
                            <td style="border: 1px solid black; padding: 5px;">${movement.date}</td>
                            <td style="border: 1px solid black; padding: 5px;">${productName}</td>
                    `;
    
                    if (movement.type === 'exit') {
                        reportHTML += `
                            <td style="border: 1px solid black; padding: 5px;">${movement.quantity}</td>
                            <td style="border: 1px solid black; padding: 5px;">${movement.price.toFixed(2)}</td>
                            <td style="border: 1px solid black; padding: 5px;">${(movement.quantity * movement.price).toFixed(2)} <strong>FC</strong></td>
                            <td style="border: 1px solid black; padding: 5px;"></td>
                            <td style="border: 1px solid black; padding: 5px;"></td>
                            <td style="border: 1px solid black; padding: 5px;"></td>
                        `;
                        totalExit += movement.quantity * movement.price;
                        product.quantity -= movement.quantity;
                    } else if (movement.type === 'entry') {
                        reportHTML += `
                            <td style="border: 1px solid black; padding: 5px;"></td>
                            <td style="border: 1px solid black; padding: 5px;"></td>
                            <td style="border: 1px solid black; padding: 5px;"></td>
                            <td style="border: 1px solid black; padding: 5px;">${movement.quantity}</td>
                            <td style="border: 1px solid black; padding: 5px;">${movement.price.toFixed(2)}</td>
                            <td style="border: 1px solid black; padding: 5px;">${(movement.quantity * movement.price).toFixed(2)} <strong>FC</strong></td>
                        `;
                        totalEntry += movement.quantity * movement.price;
                        product.quantity += movement.quantity;
                    }
    
                    // Calculate current stock after this movement
                    if (product) {
                        const stockQuantity = product.quantity;
                        const stockValue = stockQuantity * product.price;
                        totalStock = stockValue;
    
                        reportHTML += `
                            <td style="border: 1px solid black; padding: 5px;">${stockQuantity}</td>
                            <td style="border: 1px solid black; padding: 5px;">${product.price.toFixed(2)}</td>
                            <td style="border: 1px solid black; padding: 5px;">${stockValue.toFixed(2)} <strong>FC</strong></td>
                        `;
                    } else {
                        reportHTML += `
                            <td style="border: 1px solid black; padding: 5px;"></td>
                            <td style="border: 1px solid black; padding: 5px;"></td>
                            <td style="border: 1px solid black; padding: 5px;"></td>
                        `;
                    }
    
                    reportHTML += `</tr>`;
                });
    
                reportHTML += `
                    <tr style="font-weight: bold;">
                        <td colspan="2" style="border: 1px solid black; padding: 5px;">Totaux</td>
                        <td style="border: 1px solid black; padding: 5px;"></td>
                        <td style="border: 1px solid black; padding: 5px;"></td>
                        <td style="border: 1px solid black; padding: 5px;">${totalExit.toFixed(2)} <strong>FC</strong></td>
                        <td style="border: 1px solid black; padding: 5px;"></td>
                        <td style="border: 1px solid black; padding: 5px;"></td>
                        <td style="border: 1px solid black; padding: 5px;">${totalEntry.toFixed(2)} <strong>FC</strong></td>
                        <td style="border: 1px solid black; padding: 5px;"></td>
                        <td style="border: 1px solid black; padding: 5px;"></td>
                        <td style="border: 1px solid black; padding: 5px;">${totalStock.toFixed(2)} <strong>FC</strong></td>
                    </tr>
                </table>
                <button onclick="window.print()" style="margin-top: 20px;">Imprimer</button>
                `;
    
                document.getElementById('reportContainer').innerHTML = reportHTML;
            }
    
            function handleStockMovementSubmit(e) {
                e.preventDefault();
                const form = e.target;
                const productId = parseInt(form.querySelector('#productId').value);
                const product = getProducts().find(p => p.id === productId);
                
                const movement = {
                    date: form.querySelector('#movementDate').value,
                    type: form.querySelector('button').textContent.includes('entrée') ? 'entry' : 'exit',
                    productId: productId,
                    quantity: parseInt(form.querySelector('#quantity').value),
                    source: form.querySelector('#source').value,
                    reference: generateReference(
                        form.querySelector('button').textContent.includes('entrée') ? 'entry' : 'exit', 
                        product.name
                    ),
                    price: parseFloat(form.querySelector('#unitPrice').value)
                };
                
                addStockMovement(movement);
                updateProductQuantity(movement.productId, movement.quantity, movement.type);
                alert('Mouvement de stock enregistré !');
                showStockPage();
            }
    
            function handleNewProductSubmit(e) {
                e.preventDefault();
                const form = e.target;
                const imageFile = form.querySelector('#productImage').files[0];
                
                // Utiliser FileReader pour lire l'image en tant que Data URL
                const reader = new FileReader();
                reader.onload = function(event) {
                    const newProduct = {
                        name: form.querySelector('#newProductName').value,
                        quantity: parseInt(form.querySelector('#quantity').value),
                        price: parseFloat(form.querySelector('#price').value),
                        image: event.target.result // Stocker l'image comme Data URL
                    };
                    
                    // Ajouter le nouveau produit à la base de données
                    addProduct(newProduct);
                    
                    // Récupérer l'ID du nouveau produit (supposons que c'est le dernier ID)
                    const products = getProducts();
                    const newProductId = products[products.length - 1].id;
                    
                    // Créer un mouvement de stock pour le nouveau produit
                    const movement = {
                        date: form.querySelector('#movementDate').value,
                        type: 'new',
                        productId: newProductId,
                        quantity: newProduct.quantity,
                        source: 'Nouveau produit',
                        reference: generateReference('new', newProduct.name),
                        price: newProduct.price
                    };
                    
                    // Ajouter le mouvement de stock
                    addStockMovement(movement);
                    
                    alert('Nouveau produit ajouté avec succès !');
                    showStockPage();
                };
                
                if (imageFile) {
                    reader.readAsDataURL(imageFile);
                } else {
                    reader.onload({ target: { result: 'path/to/default/image.jpg' } });
                }
            }
    
            function generateReference(type, productName) {
                if (!type || !productName) {
                    return `REF-${Date.now()}`;
                }
                return `REF-${type.toUpperCase()}-${productName.substring(0, 3).toUpperCase()}-${Date.now()}`;
            }
    
            window.logout = function() {
                currentUser = null;
                mainNav.style.display = 'none';
                showLoginForm();
            }
    
            window.showUserPage = function() {
                if (currentUser.role !== 'administrateur') {
                    alert('Accès non autorisé');
                    return;
                }
    
                const users = getUsers();
                const mainAdmin = users.find(u => u.username === 'admin');
    
                mainContent.innerHTML = `
                    <h2>Gestion des Utilisateurs</h2>
                    <button onclick="showAddUserForm()" style="margin-bottom: 20px;">Ajouter un utilisateur</button>
                    <table>
                        <tr>
                            <th>Nom d'utilisateur</th>
                            <th>Rôle</th>
                            <th>Actions</th>
                        </tr>
                        ${users.map(user => `
                            <tr>
                                <td>${user.username}</td>
                                <td>${user.role}</td>
                                <td>
                                    <button onclick="editUser('${user.username}')">Modifier</button>
                                    ${user.username !== mainAdmin.username ? `<button onclick="deleteUser('${user.username}')">Supprimer</button>` : ''}
                                </td>
                            </tr>
                        `).join('')}
                    </table>
                `;
                updateActiveMenuLink('Gestion des Utilisateurs');
            }
    
            function editUser(username) {
                const user = getUsers().find(u => u.username === username);
                if (user) {
                    mainContent.innerHTML = `
                        <h2>Modifier l'utilisateur</h2>
                        <form id="editUserForm">
                            <input type="text" id="username" value="${user.username}" readonly>
                            <input type="password" id="password" placeholder="Nouveau mot de passe">
                            <select id="role">
                                <option value="administrateur" ${user.role === 'administrateur' ? 'selected' : ''}>Administrateur</option>
                                <option value="magasinier" ${user.role === 'magasinier' ? 'selected' : ''}>Magasinier</option>
                                <option value="service_vente" ${user.role === 'service_vente' ? 'selected' : ''}>Service Vente</option>
                                <option value="service_production" ${user.role === 'service_production' ? 'selected' : ''}>Service Production</option>
                            </select>
                            <button type="submit">Enregistrer les modifications</button>
                        </form>
                    `;
                    document.getElementById('editUserForm').addEventListener('submit', function(e) {
                        e.preventDefault();
                        const newPassword = document.getElementById('password').value;
                        const newRole = document.getElementById('role').value;
                        if (newPassword) user.password = newPassword;
                        user.role = newRole;
                        updateUser(user);
                        alert('Utilisateur modifié avec succès');
                        showUserPage();
                    });
                }
            }
    
            function deleteUser(username) {
                if (confirm(`Êtes-vous sûr de vouloir supprimer l'utilisateur ${username}?`)) {
                    deleteUser(username);
                    alert('Utilisateur supprimé avec succès');
                    showUserPage();
                }
            }
    
            window.showAddUserForm = function() {
                mainContent.innerHTML = `
                    <h2>Ajouter un nouvel utilisateur</h2>
                    <form id="addUserForm">
                        <input type="text" id="username" placeholder="Nom d'utilisateur" required>
                        <input type="password" id="password" placeholder="Mot de passe" required>
                        <select id="role" required>
                            <option value="administrateur">Administrateur</option>
                            <option value="magasinier">Magasinier</option>
                            <option value="service_vente">Service Vente</option>
                            <option value="service_production">Service Production</option>
                        </select>
                        <button type="submit">Ajouter l'utilisateur</button>
                    </form>
                `;
                document.getElementById('addUserForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    const newUser = {
                        username: document.getElementById('username').value,
                        password: document.getElementById('password').value,
                        role: document.getElementById('role').value
                    };
                    addUser(newUser);
                    alert('Nouvel utilisateur ajouté avec succès');
                    showUserPage();
                });
            }
    
            function updateActiveMenuLink(activeLink) {
                const menuLinks = document.querySelectorAll('#mainNav a');
                menuLinks.forEach(link => {
                    if (link.textContent === activeLink) {
                        link.classList.add('active');
                    } else {
                        link.classList.remove('active');
                    }
                });
            }
    
            showLoginForm();
        });
        </script>
    </body>
    </html>